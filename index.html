<!DOCTYPE html>
<html>
<head>
	<title>m&j</title>
	<style>
		[data-iq-component] {
			border: 1px dotted;
			margin: 10px;
		}

		[data-iq-component="ToDoItem"] {
			cursor: pointer;
		}
	</style>
	<script src="vdom.js"></script>
</head>
<body>
	<div data-iq-component="ToDoApp" class="{{this.klass}}" data-iq:deleteitem="this.deleteItem($iqEvent)">
		<ul>
			{{this.renderItems()}}
		</ul>

		<!-- <ul>
			<iq-container data-iq.for="item in this.items">
				<li data-iq-component="ToDoItem" data-iq:click="this.delete('${item}')">
					${item} {{this.check}}
				</li>
			</iq-container>
		</ul> -->

		<ul>
			<li data-iq-component="ToDoItem">asd {{this.check}}</li>
			<li data-iq-component="ToDoItem">asd {{this.check}}</li>
		</ul>

		<p>lol. {{location}}</p>

		<input
			type="text"
			placeholder="something"
			data-iq:input="this.handleKeypress($iqEvent)">
		<button data-iq:click="this.addItem()">add!</button>
	</div>

	<div data-iq-component="TwoWayBindingComponent">
		<input
			type="text"
			placeholder="type"
			data-iq:input="this.updateState($iqEvent)"
			data-iq:focus="this.focus($iqEvent)">

		<p>The text is:
			<a title="{{this.text}}" href="{{this.text}}" data-iq:click="this.stop($iqEvent)" data-iq.if="this.text">
				{{this.text}}
			</a>
			<span data-iq.if="!this.text">undefined</span>
		</p>
	</div>

	<div
		data-iq-component="CustomEventHandlerApp"
		data-iq:customnumber="this.onCustomNumber($iqEvent)">
			<div data-iq-component="CustomEventEmitterApp">
				<button data-iq:click="this.emit(42)">Emit!</button>
			</div>

			<p>The number is: {{this.customNumber}}</p>
	</div>
</body>
<script>
	'use strict';

	/* exported TimerComponent, ToDoApp, ToDoItem, TwoWayBindingComponent, CustomEventHandlerApp, CustomEventEmitterApp */

	function TwoWayBindingComponent() {
		this.text = '';

		this.updateState = (e) => {
			this.text = e.target.value;
		};

		this.focus = (e) => {
			e.target.select();
		};

		this.stop = (e) => {
			alert(`clicked on the link with text ${this.text}!`);
			e.preventDefault();
		};
	}

	function TimerComponent() {
		this.seconds = 0;

		setInterval(() => {
			// this.seconds++;
		}, 1000);

		this.reset = () => {
			this.seconds = 0;
		};
	}

	function ToDoApp({host, view, event}) {
		this.items = ['hi jessie', '2'];
		this.klass = 'wut';

		this.renderItems = () => this.items
			.map(item =>
				`<li data-iq-component="ToDoItem" data-iq:click="this.delete('${item}')">${item} {{this.check}}</li>`).join('');

		setTimeout(() => {
			this.items.push('hello');
		}, 1000);

		setTimeout(() => {
			this.items.push('bye');
		}, 1500);

		setTimeout(() => {
			this.items.splice(1, 1);
		}, 2000);

		this.handleKeypress = (e) => {
			this.klass = e.target.value;
		};

		this.addItem = () => {
			const input = host.querySelector('input');
			this.items.push(input.value);
			input.value = '';
			input.focus();
		};

		this.deleteItem = event.handle((item) => {
			this.items.splice(this.items.indexOf(item), 1);
		});
	}

	function ToDoItem({host, view, event}) {
		this.check = 'v';

		this.delete = (item) => {
			event.dispatch('deleteitem', item);
			this.check = 'a';
		};
	}

	function CustomEventHandlerApp({event: customEvent}) {
		this.customNumber = undefined;
		this.onCustomNumber = customEvent.handle((number) => {
			this.customNumber = number;
		});
	}

	function CustomEventEmitterApp({event: customEvent}) {
		this.emit = (number) => {
			customEvent.dispatch('customnumber', number);
		};
	}
</script>
</html>